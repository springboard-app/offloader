<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>Springboard Dashboard</title>
  </head>
  <body>
      <h2>Springboard Offloader Dashboard</h2>
      <input id="search" type="text" placeholder="Search..">
      <button onclick="search()">Connect</button>
      <select id="offloaders"></select>
      <br>
      <br>

      <h3>Connected Machine Information</h3>
      <h4 id="system_info"></h3>
      <table style="width:75%;">
        <tr>
                <th>CPU</th>
                <th>Current Load</th>
                <th>Job Status</th>
        </tr>
        <tr style="padding:10%;">
      <th id="cpu_info"></th>
      <th id="load_info"></th>
      <th id="active_info"></th>
    </tr>
    </table>

      <script>
        var text = document.getElementById("search");
        text.value = "ws://localhost:8080"

        var cpu_info = document.getElementById("cpu_info");
        var active_info = document.getElementById("active_info");
        var load_info = document.getElementById("load_info");
        var system_info = document.getElementById("system_info");

        const WebSocket = require('ws');
 
        var ws;
        var initialized = false;
        
        setInterval(pollData,1000);

        function pollData(){
            if (initialized == true){
                ws.send('information please');
            }
        }

        function search(){
            var val = text.value
            ws = new WebSocket(val);
            
            ws.on('open', function open() {
            
                ws.send('information please');
                initialized = true;
            });
            
            ws.on('message', function incoming(data) {
            console.log(data);
            
            data = JSON.parse(data)

            cpu_info.innerHTML = data['cpu_data'];
            system_info.innerHTML = data['system_data']; 
            active_info.innerHTML = data['active'];
            if (data['active'] == "Active"){
                active_info.style.color="green"
            }else{
                active_info.style.color="red"
            }
            load_info.innerHTML = Number.parseFloat(data['load_data']).toPrecision(4) + "%";
            });
            
        }
      </script>

  </body>
</html>